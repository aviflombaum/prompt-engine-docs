---
title: Authentication
description: "Securing your PromptEngine installation"
icon: LockIcon
order: 2
---

# Adding Authentication to PromptEngine

Authentication is crucial in any application to verify the identity of users and to ensure that each user accesses only the data they are permitted to see. For PromptEngine, implementing a robust authentication system will safeguard sensitive information and provide a personalized user experience.

## Why Authentication Matters

<Callout type="info">
Authentication protects user data and prevents unauthorized access, enhancing both security and user trust.
</Callout>

Authentication serves multiple purposes:
- **Security**: Ensures that access to resources is granted only to authenticated and authorized users.
- **User Experience**: Enables personalized features and saves user preferences.
- **Data Integrity**: Protects user data from being tampered with by unauthorized users.

## Integration with Devise

Devise is a flexible authentication solution for Rails based on Warden. It handles user registration, sessions, password resets, and more.

### Setup Devise in Your Rails Application

<Steps>
  <Step>
    ### Step 1: Add Devise to Your Gemfile
    Include Devise in your Gemfile to add comprehensive authentication capabilities to PromptEngine.

    ```ruby
    gem 'devise'
    ```
    Run `bundle install` to install the gem.
  </Step>
  <Step>
    ### Step 2: Run the Devise Generator
    Install Devise configurations and views by running the generator command.

    ```bash
    rails generate devise:install
    ```
  </Step>
  <Step>
    ### Step 3: Configure Your Model
    Set up a User model if you don't already have one, or configure an existing model to work with Devise.

    ```bash
    rails generate devise User
    ```
  </Step>
  <Step>
    ### Step 4: Run Migrations
    Apply the database changes required for Devise.

    ```bash
    rails db:migrate
    ```
  </Step>
  <Step>
    ### Step 5: Set Up Views and Routes
    Customize the views generated by Devise to match the UI of PromptEngine. Check your routes to ensure they include authentication paths.

    ```ruby
    rails generate devise:views
    ```
  </Step>
</Steps>

## Custom Authentication Solutions

For those who require a more tailored approach, building a custom authentication system might be necessary.

<Tabs items={['Basic Custom Auth', 'JWT-Based Auth']}>
  <Tab value="Basic Custom Auth">
    Implementing a basic session-based authentication system involves creating a SessionsController and utilizing Rails' `has_secure_password` feature.

    ```ruby
    class SessionsController < ApplicationController
      def create
        user = User.find_by(email: params[:email])
        if user&.authenticate(params[:password])
          session[:user_id] = user.id
          redirect_to root_path, notice: 'Logged in successfully'
        else
          flash.now[:alert] = 'Invalid email or password'
          render :new
        end
      end
    end
    ```
  </Tab>
  <Tab value="JWT-Based Auth">
    For APIs, JWT (JSON Web Tokens) provide a stateless authentication mechanism. After validating credentials, the server issues a token that the client must include in subsequent requests.

    ```ruby
    class AuthController < ApplicationController
      def login
        user = User.find_by(email: params[:email])
        if user&.authenticate(params[:password])
          token = JWT.encode({ user_id: user.id }, 'your_secret_key', 'HS256')
          render json: { token: token }
        else
          render json: { error: 'Invalid credentials' }, status: :unauthorized
        end
      end
    end
    ```
  </Tab>
</Tabs>

## Role-Based Access Control

Implementing role-based access control (RBAC) allows different permissions for different types of users.

<Steps>
  <Step>
    ### Define Roles
    Define the roles in your application, typically within the User model or a dedicated Role model.

    ```ruby
    enum role: [:user, :admin, :super_admin]
    ```
  </Step>
  <Step>
    ### Enforce Access
    Utilize `before_action` callbacks in your controllers to restrict access based on user roles.

    ```ruby
    before_action :check_admin, only: [:dashboard]

    def check_admin
      redirect_to root_path unless current_user.admin?
    end
    ```
  </Step>
</Steps>

## Protecting Admin Routes

Ensure that only administrative users can access certain parts of your application.

<Callout type="warning">
Always protect administrative interfaces to prevent unauthorized access.
</Callout>

Using Devise, you can easily restrict routes by defining an `authenticate` scope:

```ruby
authenticate :user, lambda { |u| u.admin? } do
  namespace :admin do
    resources :posts
    # other administrative resources
  end
end
```

With these steps, PromptEngine can securely manage user authentication, providing a safe and reliable environment for both developers and users.
